parameters:
- name: carrierToken
  type: string
- name: jobId
  type: string
- name: projectId
  type: string
- name: redisHost
  type: string
- name: redisPassword
  type: string
- name: galloperUrl
  type: string
- name: displayName
  type: string
  default: 'Carrier Run'

steps:
  - script: >-
      docker run
      -i
      --rm
      -e REDIS_HOST=${REDIS_HOST}
      -e REDIS_PASSWORD=${REDIS_PASSWORD}
      -e galloper_url=${GALLOPER_URL}
      -e project_id=${PROJECT_ID}
      -e token=${TOKEN}
      getcarrier/control_tower:latest
      --test_id ${JOB_ID}
    displayName: ${{ parameters.displayName }}
    env:
      REDIS_HOST: ${{ parameters.redisHost }}
      REDIS_PASSWORD: ${{ parameters.redisPassword }}
      GALLOPER_URL: ${{ parameters.galloperUrl }}
      PROJECT_ID: ${{ parameters.projectId }}
      TOKEN: ${{ parameters.carrierToken }}
      JOB_ID: ${{ parameters.jobId }}
