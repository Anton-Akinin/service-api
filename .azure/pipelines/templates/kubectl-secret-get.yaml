parameters:
- name: name
  type: string
  default: getSecret
- name: displayName
  type: string
  default: 'Get secret'
- name: namespace
  type: string
  default: default
- name: secret
  type: string

steps:
  - bash: |
      `kubectl get secret ${SECRET} -o json -n ${NS} | jq -r '.data | to_entries | map([.key, .value]|join("="))|join("\n")'|sed -E -n 's/([^=]+)=(.+)/echo "##vso[task.setvariable variable=\1;isOutput=true;issecret=true]$(echo "\2" | base64 -d)"/ p' >credentials.sh`
      source credentials.sh
    name: ${{ parameters.name }}
    displayName: ${{ parameters.displayName }}
    env:
      SECRET: ${{ parameters.secret }}
      NS: ${{ parameters.namespace }}
